<!DOCTYPE html>
<html>
<head>
    <title>Debug Whitelist Delete</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Debug Whitelist Delete</h1>
    
    <div>
        <h2>Test Delete API</h2>
        <input type="text" id="test-ip" placeholder="Enter IP to delete" value="41.142.94.91">
        <button onclick="testDelete()">Test Delete</button>
        <button onclick="checkSession()">Check Session</button>
        <button onclick="listIPs()">List All IPs</button>
    </div>
    
    <div id="results" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
        <h3>Results:</h3>
        <div id="output"></div>
    </div>

    <script>
        function log(message) {
            $('#output').append('<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>');
        }

        function testDelete() {
            const ip = $('#test-ip').val();
            log('Testing delete for IP: ' + ip);
            
            // Try the simple endpoint first
            $.ajax({
                url: "/api/delete-whitelist-ip-simple",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ ip_address: ip }),
                success: function(response) {
                    log('Simple delete response: ' + JSON.stringify(response));
                },
                error: function(xhr, status, error) {
                    log('Simple delete error: ' + status + ' - ' + error);
                    log('Response: ' + xhr.responseText);
                }
            });
            
            // Also try the original endpoint
            $.ajax({
                url: "/api/delete-whitelist-ip",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ ip_address: ip }),
                success: function(response) {
                    log('Original delete response: ' + JSON.stringify(response));
                },
                error: function(xhr, status, error) {
                    log('Original delete error: ' + status + ' - ' + error);
                    log('Response: ' + xhr.responseText);
                }
            });
        }

        function checkSession() {
            $.ajax({
                url: "/api/debug-whitelist-ips",
                type: "GET",
                success: function(response) {
                    log('Session debug: ' + JSON.stringify(response));
                },
                error: function(xhr, status, error) {
                    log('Session error: ' + status + ' - ' + error);
                }
            });
        }

        function listIPs() {
            $.ajax({
                url: "/api/list-whitelist-ips",
                type: "GET",
                success: function(response) {
                    log('IPs list: ' + JSON.stringify(response));
                },
                error: function(xhr, status, error) {
                    log('List error: ' + status + ' - ' + error);
                }
            });
        }
    </script>
</body>
</html>
