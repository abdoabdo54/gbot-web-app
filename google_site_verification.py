\"\"\"\nGoogle Site Verification helper using official API.\n\"\"\"\nfrom __future__ import annotations\n\nfrom typing import Dict, Optional\n\nfrom googleapiclient.discovery import build\nfrom google.oauth2 import service_account\n\n\ndef _build_credentials(service_account_path: str, scopes: Optional[list] = None):\n    if not service_account_path:\n        raise ValueError(\"GOOGLE_SERVICE_ACCOUNT_PATH is not configured. Provide a service account JSON path.\")\n    if scopes is None:\n        scopes = [\n            \"https://www.googleapis.com/auth/siteverification\",\n        ]\n    credentials = service_account.Credentials.from_service_account_file(service_account_path, scopes=scopes)\n    return credentials\n\n\ndef get_dns_txt_token(service_account_path: str, domain: str) -> Dict:\n    \"\"\"Get DNS TXT token for domain verification.\"\"\"\n    creds = _build_credentials(service_account_path)\n    service = build(\"siteVerification\", \"v1\", credentials=creds, cache_discovery=False)\n\n    body = {\n        \"site\": {\n            \"type\": \"INET_DOMAIN\",\n            \"identifier\": domain,\n        },\n        \"verificationMethod\": \"DNS_TXT\",\n    }\n    token_resp = service.webResource().getToken(body=body).execute()\n    # token_resp contains {'method': 'DNS_TXT', 'token': '...'}\n    return {\n        \"status\": \"success\",\n        \"token\": token_resp.get(\"token\"),\n        \"method\": token_resp.get(\"method\"),\n    }\n\n\ndef verify_domain_with_dns(service_account_path: str, domain: str, method: str = \"DNS_TXT\") -> Dict:\n    \"\"\"Attempt to verify a domain via DNS method.\"\"\"\n    creds = _build_credentials(service_account_path)\n    service = build(\"siteVerification\", \"v1\", credentials=creds, cache_discovery=False)\n\n    body = {\n        \"site\": {\n            \"type\": \"INET_DOMAIN\",\n            \"identifier\": domain,\n        }\n    }\n    verification = service.webResource().insert(verificationMethod=method, body=body).execute()\n    return {\n        \"status\": \"success\",\n        \"verification\": verification,\n    }\n