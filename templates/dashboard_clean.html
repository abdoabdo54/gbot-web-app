{% extends "base.html" %}
{% block title %}Dashboard - GBot Web{% endblock %}

{% block content %}
<!-- Tab Navigation -->
<div class="tab-navigation">
    <nav>
        <button class="tab-button active" onclick="showTab('tab1')">
            <i class="fas fa-user-friends"></i>
            <span>Account & User Mgmt</span>
        </button>
        <button class="tab-button" onclick="showTab('tab2')">
            <i class="fas fa-user-plus"></i>
            <span>User Create/Delete/Domain</span>
        </button>
        <button class="tab-button" onclick="showTab('tab3')">
            <i class="fas fa-exchange-alt"></i>
            <span>Bulk Domain Change</span>
        </button>
    </nav>
</div>

<!-- Tab 1: Account & User Management (existing content) -->
<div id="tab1" class="tab-content active">    
<!-- Account Selection & Authentication -->
<div class="github-card">
    <div class="github-card-header">
        <h3 class="github-card-title">
            <i class="fas fa-user-friends"></i>
            Account Selection & Authentication
        </h3>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end; margin-bottom: 20px;">
        <div class="form-group-github">
            <label for="account-select" class="form-label-github">
                <i class="fas fa-user-circle"></i> Select Account
            </label>
            <select id="account-select" class="form-control-github">
            <option value="">Choose an account...</option>
                {% for account in accounts %}
                <option value="{{ account.account_name }}" data-account-id="{{ account.id }}">{{ account.account_name }}</option>
            {% endfor %}
        </select>
        </div>
        <button onclick="authenticateAccount()" class="btn-github btn-github-primary">
            <i class="fas fa-key"></i> Authenticate Selected
        </button>
    </div>
    
    <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px;">
        {% if session.role != 'mailer' %}
        <button onclick="openAddAccountModal()" class="btn-github">
            <i class="fas fa-plus"></i> Add Manually
        </button>
        <button onclick="addFromServerJSON()" class="btn-github">
            <i class="fas fa-folder-open"></i> Add from Server JSON
        </button>
        {% endif %}
        {% if session.role == 'admin' %}
        <button onclick="forceTokenStatusCheck()" class="btn-github" style="background-color: var(--color-warning-emphasis); border-color: var(--color-warning-emphasis); color: #ffffff;">
            <i class="fas fa-search"></i> Check Token Status Now (Admin)
        </button>
        {% endif %}    
        <button onclick="enterAuthorizationCode()" class="btn-github">
            <i class="fas fa-code"></i> Enter Authorization Code
        </button>
    </div>
    
    <!-- Search and Account List Area -->
    <div class="account-management-area">
        <div class="search-and-list">
            <input type="text" id="account-search" placeholder="Search accounts in list..." 
                    oninput="filterAccounts()" class="search-input" 
                    autocomplete="off" autocomplete="nope" readonly onfocus="this.removeAttribute('readonly');">
            
            <div id="account-list-area" class="account-list">
                {% for account in accounts %}
                <div class="account-item" data-account-name="{{ account.account_name }}" data-account-id="{{ account.id }}" onclick="selectAccountFromList(this.dataset.accountName, this.dataset.accountId)">
                    {{ account.account_name }}
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="account-actions">
            <button onclick="authenticateFromList()" class="action-button">
                üîë Authenticate<br>(List Selection)
            </button>
            <button onclick="deleteFromList()" class="action-button delete-button">
                üóëÔ∏è Delete Account<br>(List Selection)
            </button>
        </div>
    </div>
    <div id="account-count-display" class="count-display">
        <span id="account-stats">Loading account statistics...</span>
    </div>
    <div id="auth-status" class="status-box">
        <p>No account authenticated</p>
    </div>
</div>

<!-- Add Account Modal -->
<div id="addAccountModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-plus"></i> Add Account Manually
            </h3>
            <button type="button" class="btn-github" onclick="closeAddAccountModal()" style="margin-left: auto;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
        <form id="addAccountForm">
                <div class="form-group-github">
                    <label for="new-account-email" class="form-label-github">
                        <i class="fas fa-envelope"></i> Account Email
                    </label>
                    <input type="email" id="new-account-email" class="form-control-github" required placeholder="admin@yourdomain.com">
            </div>
                <div class="form-group-github">
                    <label for="new-client-id" class="form-label-github">
                        <i class="fas fa-key"></i> Client ID
                    </label>
                    <input type="text" id="new-client-id" class="form-control-github" required placeholder="123456789-abcdef.apps.googleusercontent.com">
            </div>
                <div class="form-group-github">
                    <label for="new-client-secret" class="form-label-github">
                        <i class="fas fa-lock"></i> Client Secret
                    </label>
                    <input type="password" id="new-client-secret" class="form-control-github" required placeholder="GOCSPX-your_client_secret">
            </div>
        </form>
        </div>
        <div class="modal-footer">
            <button type="button" onclick="saveNewAccount()" class="btn-github btn-github-primary">
                <i class="fas fa-save"></i> Save Account
            </button>
            <button type="button" onclick="closeAddAccountModal()" class="btn-github">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>
</div>



<!-- OAuth Authorization Modal -->
<div id="oauthModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-link"></i> OAuth Authorization Required
            </h3>
            <button type="button" class="btn-github" onclick="closeOAuthModal()" style="margin-left: auto;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>Please copy this link and open it in your browser to authorize the account:</p>
            <div id="oauthUrl" class="data-display" style="font-family: monospace; word-break: break-all; margin: 16px 0;"></div>
            <div style="background-color: rgba(9, 105, 218, 0.1); border: 1px solid var(--color-accent-emphasis); border-radius: 6px; padding: 12px; color: var(--color-accent-fg); font-size: 14px;">
                <i class="fas fa-lightbulb"></i>
                <strong>Tip:</strong> You can copy this link to use in another browser or app for authorization.
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="copyOAuthUrl()" class="btn-github">
                <i class="fas fa-copy"></i> Copy Link
            </button>
            <button onclick="openOAuthUrl()" class="btn-github btn-github-primary">
                <i class="fas fa-external-link-alt"></i> Open Link
            </button>
            <button onclick="closeOAuthModal()" class="btn-github">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
    </div>
</div>

    <!-- User Listing & Actions -->
<div class="github-card">
    <div class="github-card-header">
        <h3 class="github-card-title">
            <i class="fas fa-users"></i>
            User Listing & Basic Actions
        </h3>
    </div>
        
        <div class="button-row">
        <button onclick="retrieveUsers()" class="btn-github btn-github-primary">
            <i class="fas fa-chart-bar"></i> Retrieve All Users
        </button>
        <button onclick="clearUserList()" class="btn-github">
            <i class="fas fa-broom"></i> Clear List
        </button>
        <button onclick="copyAllUsers()" class="btn-github">
            <i class="fas fa-copy"></i> Copy All
        </button>
        </div>
        
        <div id="user-display" class="data-display">
        <div class="status-info">
            <p><strong><i class="fas fa-users"></i> User Management</strong></p>
            <p>Click "Retrieve All Users" to load and display all users from your Google Workspace.</p>
            <p><small>This will show user status (Active/Suspended), admin privileges, and provide options for bulk operations.</small></p>
        </div>
        </div>
        
        <div id="user-count" class="count-display">Total Users: 0</div>
        
    <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end; margin-top: 16px;">
        <div class="form-group-github">
            <label for="new-password" class="form-label-github">
                <i class="fas fa-lock"></i> New Password for All Users
            </label>
            <input type="password" id="new-password" class="form-control-github" placeholder="Enter new password for all users" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');">
        </div>
        <button onclick="updateAllPasswords()" class="btn-github btn-github-danger">
            <i class="fas fa-key"></i> Update Password (All)
        </button>
        </div>
    </div>

    <!-- Domain Info
    <div class="section">
        <h3>üåê Domain Info & Subdomain Utility</h3>
        
        <div class="button-row">
            <button onclick="retrieveDomains()">üîç Retrieve Domains</button>
            <button onclick="clearDomainDisplay()">üßπ Clear Display</button>
        </div>
        
        <div id="domain-display" class="data-display">
            <p>Click 'Retrieve Domains' to view domains here...</p>
        </div>
    </div> -->

    <!-- Suspended Users -->
<div class="github-card">
    <div class="github-card-header">
        <h3 class="github-card-title">
            <i class="fas fa-user-slash"></i>
            Suspended User Management
        </h3>
    </div>
        
        <div class="button-row">
        <button onclick="loadSuspendedUsers()" class="btn-github btn-github-primary">
            <i class="fas fa-search"></i> Load Suspended Users
        </button>
        <button onclick="copySuspendedUsers()" class="btn-github">
            <i class="fas fa-copy"></i> Copy Selected
        </button>
        <button onclick="refreshSuspendedUsers()" class="btn-github">
            <i class="fas fa-sync-alt"></i> Refresh Status
        </button>
        <button onclick="clearSuspendedUsers()" class="btn-github">
            <i class="fas fa-broom"></i> Clear Display
        </button>
        </div>
        
        <div id="suspended-display" class="data-display">
        <div class="status-info">
            <p><strong><i class="fas fa-user-slash"></i> Suspended User Management</strong></p>
            <p>Click "Load Suspended Users" to check for suspended accounts in your Google Workspace.</p>
            <p><small>This will show all users with suspended status, including their names, emails, and admin privileges.</small></p>
        </div>
    </div>
</div>
</div>

<!-- Tab 2: User Create/Delete/Domain -->
<div id="tab2" class="tab-content">
    
    <!-- Create Single User -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-user-plus"></i>
                Create Single User
            </h3>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group-github">
                <label for="new-user-first-name" class="form-label-github">
                    <i class="fas fa-user"></i> First Name
                </label>
                <input type="text" id="new-user-first-name" class="form-control-github" placeholder="Enter first name">
        </div>
            <div class="form-group-github">
                <label for="new-user-last-name" class="form-label-github">
                    <i class="fas fa-user"></i> Last Name
                </label>
                <input type="text" id="new-user-last-name" class="form-control-github" placeholder="Enter last name">
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
            <div class="form-group-github">
                <label for="new-user-email" class="form-label-github">
                    <i class="fas fa-envelope"></i> Email Address
                </label>
                <input type="email" id="new-user-email" class="form-control-github" placeholder="user@domain.com">
            </div>
            <div class="form-group-github">
                <label for="new-user-password" class="form-label-github">
                    <i class="fas fa-lock"></i> Password
                </label>
                <input type="password" id="new-user-password" class="form-control-github" placeholder="Enter password">
            </div>
        </div>
        <button onclick="createSingleUser()" class="btn-github btn-github-primary">
            <i class="fas fa-plus"></i> Create User
        </button>
    </div>

    <!-- Domain Management -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-globe"></i>
                Domain Management
            </h3>
        </div>
        <div class="button-row">
            <button onclick="getDomainInfo()" class="btn-github btn-github-primary">
                <i class="fas fa-search"></i> Retrieve Domains
            </button>
        </div>
        <div id="domain-info-display" class="data-display">
            <div class="status-info">
                <p><strong><i class="fas fa-globe"></i> Domain Information</strong></p>
                <p>Click "Retrieve Domains" to view domains here...</p>
        </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end; margin-top: 16px;">
            <div class="form-group-github">
                <label for="new-domain-alias" class="form-label-github">
                    <i class="fas fa-plus"></i> New Domain Alias
                </label>
                <input type="text" id="new-domain-alias" class="form-control-github" placeholder="Enter new domain alias">
            </div>
            <button onclick="addDomainAlias()" class="btn-github btn-github-primary">
                <i class="fas fa-plus"></i> Add Domain Alias
            </button>
        </div>
    </div>

    <!-- Create Users from CSV File -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-file-csv"></i>
                Create Users from CSV File
            </h3>
        </div>
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end;">
            <div class="form-group-github">
                <label for="csv-file-input" class="form-label-github">
                    <i class="fas fa-file-upload"></i> Select CSV File
                </label>
                <input type="file" id="csv-file-input" class="form-control-github" accept=".csv">
            </div>
            <button onclick="createUsersFromCSV()" class="btn-github btn-github-primary">
                <i class="fas fa-upload"></i> Create Users from CSV
            </button>
        </div>
    </div>

    <!-- Create Random Users -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-random"></i>
                Create Random Users
            </h3>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 16px; align-items: end;">
            <div class="form-group-github">
                <label for="random-user-count" class="form-label-github">
                    <i class="fas fa-hashtag"></i> Number of Users
                </label>
                <input type="number" id="random-user-count" class="form-control-github" min="1" max="100" placeholder="e.g., 10">
            </div>
            <div class="form-group-github">
                <label for="random-user-domain" class="form-label-github">
                    <i class="fas fa-globe"></i> Domain
                </label>
                <input type="text" id="random-user-domain" class="form-control-github" placeholder="example.com">
            </div>
            <button onclick="createRandomUsers()" class="btn-github btn-github-primary">
                <i class="fas fa-random"></i> Create Random Users
            </button>
        </div>
    </div>

    <!-- Change Domain for Specific Users -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-exchange-alt"></i>
                Change Domain for Specific Users
            </h3>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group-github">
                <label for="old-domain" class="form-label-github">
                    <i class="fas fa-globe"></i> Current Domain
                </label>
                <input type="text" id="old-domain" class="form-control-github" placeholder="old.com">
            </div>
            <div class="form-group-github">
                <label for="new-domain" class="form-label-github">
                    <i class="fas fa-globe"></i> New Domain
                </label>
                <input type="text" id="new-domain" class="form-control-github" placeholder="new.com">
            </div>
        </div>
        <div class="form-group-github" style="margin-bottom: 20px;">
            <label for="domain-change-emails" class="form-label-github">
                <i class="fas fa-envelope"></i> Email Addresses (one per line)
            </label>
            <textarea id="domain-change-emails" class="form-control-github" rows="4" placeholder="user1@old.com&#10;user2@old.com&#10;user3@old.com"></textarea>
        </div>
        <button onclick="changeDomainForUsers()" class="btn-github btn-github-primary">
            <i class="fas fa-exchange-alt"></i> Change Domain for These Users
        </button>
    </div>

    <!-- Delete Specific Users -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-user-times"></i>
                Delete Specific Users
            </h3>
        </div>
        <div class="form-group-github" style="margin-bottom: 20px;">
            <label for="delete-user-emails" class="form-label-github">
                <i class="fas fa-envelope"></i> Email Addresses to Delete (one per line)
            </label>
            <textarea id="delete-user-emails" class="form-control-github" rows="4" placeholder="user1@domain.com&#10;user2@domain.com&#10;user3@domain.com"></textarea>
        </div>
        <button onclick="deleteSpecificUsers()" class="btn-github btn-github-danger">
            <i class="fas fa-trash"></i> Delete These Users
        </button>
    </div>

    <!-- Results Log -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-file-alt"></i>
                Results Log
            </h3>
        </div>
        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
            <button onclick="clearResultsLog()" class="btn-github">
                <i class="fas fa-broom"></i> Clear Log
            </button>
            <button onclick="copyResultsLog()" class="btn-github">
                <i class="fas fa-copy"></i> Copy Log
            </button>
        </div>
        <div id="results-log" class="data-display" style="font-family: monospace; font-size: 13px;"></div>
    </div>
</div>

<!-- Tab 3: Bulk Domain Change -->
<div id="tab3" class="tab-content">
    
    <!-- Workflow 1: Change Domain using CSV File -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-file-csv"></i>
                Workflow 1: Change Domain using CSV File
            </h3>
        </div>
        
        <!-- Step 1.1: Download Current Users to CSV -->
        <div style="margin-bottom: 32px;">
            <h4 style="font-size: 16px; font-weight: 600; color: var(--color-fg-default); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-download" style="color: var(--color-accent-fg);"></i>
                Step 1.1: Download Current Users to CSV
            </h4>
            <div style="margin-bottom: 16px;">
                <button onclick="downloadAllUsersCSV()" class="btn-github btn-github-primary">
                    <i class="fas fa-download"></i> Download All Users
                </button>
                </div>
            <div style="background-color: rgba(9, 105, 218, 0.1); border: 1px solid var(--color-accent-emphasis); border-radius: 6px; padding: 12px; color: var(--color-accent-fg); font-size: 14px;">
                <i class="fas fa-info-circle"></i>
                CSV will be saved to: <strong id="csv-save-path">Downloads folder</strong>
            </div>
        </div>
        
        <!-- Step 1.2: Select New Domain and Apply to Downloaded CSV -->
        <div style="margin-bottom: 32px;">
            <h4 style="font-size: 16px; font-weight: 600; color: var(--color-fg-default); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-globe" style="color: var(--color-accent-fg);"></i>
                Step 1.2: Select New Domain and Apply to Downloaded CSV
            </h4>
            <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 16px;">
                <button onclick="retrieveAvailableDomains()" class="btn-github">
                    <i class="fas fa-search"></i> Retrieve Available Domains
                </button>
                <button onclick="getDomainUsageStats()" class="btn-github" style="background-color: var(--color-success-emphasis); border-color: var(--color-success-emphasis); color: #ffffff;">
                    <i class="fas fa-chart-bar"></i> Domain Usage Stats
                </button>
                <button onclick="clearOldDomainData()" class="btn-github" style="background-color: var(--color-warning-emphasis); border-color: var(--color-warning-emphasis); color: #ffffff;">
                    <i class="fas fa-trash"></i> Clear Old Data
                </button>
                <button onclick="applySelectedDomainToCSV()" class="btn-github btn-github-primary">
                    <i class="fas fa-check"></i> Apply Selected Domain to CSV
                </button>
                <button onclick="debugDomainUsers()" class="btn-github" style="background-color: #6f42c1; border-color: #6f42c1; color: #ffffff;">
                    <i class="fas fa-bug"></i> Debug Domain Users
                </button>
                </div>
                
            <div id="available-domains" class="data-display">
                <div class="status-info">
                    <p><strong><i class="fas fa-globe"></i> Domain Selection</strong></p>
                    <p>Click 'Retrieve Available Domains' to view available domains</p>
                </div>
            </div>
        </div>
        
        <!-- Step 1.3: Process Domain Changes from Modified CSV -->
        <div>
            <h4 style="font-size: 16px; font-weight: 600; color: var(--color-fg-default); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-cogs" style="color: var(--color-accent-fg);"></i>
                Step 1.3: Process Domain Changes from Modified CSV
            </h4>
            <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end; margin-bottom: 16px;">
                <div class="form-group-github">
                    <label for="csv-file-path" class="form-label-github">
                        <i class="fas fa-file-csv"></i> CSV File Path
                    </label>
                    <input type="text" id="csv-file-path" class="form-control-github" placeholder="CSV file path will appear here after download/apply, or browse manually..." readonly>
                </div>
                <button onclick="browseCSVFile()" class="btn-github">
                    <i class="fas fa-folder-open"></i> Browse Manually...
                </button>
                </div>
            <button onclick="processDomainChangesFromCSV()" class="btn-github btn-github-primary">
                <i class="fas fa-cogs"></i> Process Domain Changes from CSV
            </button>
        </div>
    </div>

    <!-- Workflow 2: Change Domain for All Users (Non-CSV, Excludes Admin) -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-exchange-alt"></i>
                Workflow 2: Change Domain for All Users (Non-CSV, Excludes Admin)
            </h3>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
            <div class="form-group-github">
                <label for="current-domain-suffix" class="form-label-github">
                    <i class="fas fa-globe"></i> Current Domain Suffix
                </label>
                <input type="text" id="current-domain-suffix" class="form-control-github" placeholder="old-domain.com">
            </div>
            <div class="form-group-github">
                <label for="new-domain-suffix" class="form-label-github">
                    <i class="fas fa-globe"></i> New Domain Suffix
                </label>
                <input type="text" id="new-domain-suffix" class="form-control-github" placeholder="new-domain.com">
            </div>
            </div>
        
        <button onclick="changeDomainForAllUsers()" class="btn-github" style="background-color: var(--color-warning-emphasis); border-color: var(--color-warning-emphasis); color: #ffffff;">
            <i class="fas fa-exchange-alt"></i> Change Domain for ALL Matching Users (Non-Admin)
        </button>
    </div>

    <!-- Results Log (Covers Both Workflows) -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-file-alt"></i>
                Results Log (Covers Both Workflows)
            </h3>
        </div>
        
        <div style="margin-bottom: 16px;">
            <button onclick="clearBulkDomainLog()" class="btn-github">
                <i class="fas fa-broom"></i> Clear Log
            </button>
        </div>
        
        <div id="bulk-domain-results" class="data-display" style="font-family: monospace; font-size: 13px;">
            <div class="status-info">
                <p><strong><i class="fas fa-file-alt"></i> Processing Results</strong></p>
                <p>Processing results will appear here...</p>
            </div>
        </div>
    </div>

    <!-- SMTP Credential Tester -->
    <div class="github-card" style="margin-top: 32px;">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-envelope"></i>
                SMTP Credential Tester
            </h3>
        </div>
        
        <div class="form-group-github" style="margin-bottom: 12px;">
            <label for="smtp-credentials" class="form-label-github">
                <i class="fas fa-key"></i> SMTP Credentials (email:password, one per line)
            </label>
            <textarea id="smtp-credentials" class="form-control-github" rows="3" placeholder="user1@gmail.com:password123&#10;user2@outlook.com:apppassword456&#10;user3@yahoo.com:secretpass789"></textarea>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div class="form-group-github">
                <label for="smtp-recipient" class="form-label-github">
                    <i class="fas fa-envelope"></i> Recipient Email
                </label>
                <input type="email" id="smtp-recipient" class="form-control-github" placeholder="test@domain.com">
            </div>
            <div class="form-group-github">
                <label for="smtp-server" class="form-label-github">
                    <i class="fas fa-server"></i> SMTP Server
                </label>
                <input type="text" id="smtp-server" class="form-control-github" value="smtp.gmail.com" placeholder="SMTP Server">
            </div>
            <div class="form-group-github">
                <label for="smtp-port" class="form-label-github">
                    <i class="fas fa-plug"></i> Port
                </label>
                <input type="number" id="smtp-port" class="form-control-github" value="587" placeholder="Port">
            </div>
        </div>
        
        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
            <button onclick="testSMTPCredentials()" class="btn-github btn-github-primary">
                <i class="fas fa-paper-plane"></i> Send Test Emails
            </button>
            <button onclick="interruptSMTPTesting()" class="btn-github" style="background-color: var(--color-warning-emphasis); border-color: var(--color-warning-emphasis); color: #ffffff;">
                <i class="fas fa-stop"></i> Interrupt Sending
            </button>
            <button onclick="clearSMTPResults()" class="btn-github">
                <i class="fas fa-broom"></i> Clear Log / Reset Files
            </button>
        </div>
        
        <div>
            <h4 style="font-size: 16px; font-weight: 600; color: var(--color-fg-default); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-chart-bar" style="color: var(--color-accent-fg);"></i>
                SMTP Test Results
            </h4>
            <div id="smtp-results-log" class="data-display" style="font-family: monospace; font-size: 13px;">
                <div class="status-info">
                    <p><strong><i class="fas fa-envelope"></i> SMTP Testing Results</strong></p>
                    <p>Test results will appear here...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Generate Sample CSV for User Creation -->
    <div class="github-card">
        <div class="github-card-header">
            <h3 class="github-card-title">
                <i class="fas fa-file-csv"></i>
                Generate Sample CSV for User Creation
            </h3>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">
            <div class="form-group-github">
                <label for="csv-num-users" class="form-label-github">
                    <i class="fas fa-hashtag"></i> Number of Users
                </label>
                <input type="number" id="csv-num-users" class="form-control-github" min="1" max="1000" placeholder="e.g., 50">
            </div>
            <div class="form-group-github">
                <label for="csv-domain" class="form-label-github">
                    <i class="fas fa-globe"></i> Domain
                </label>
                <input type="text" id="csv-domain" class="form-control-github" placeholder="yourdomain.com">
            </div>
            <div class="form-group-github">
                <label for="csv-password" class="form-label-github">
                    <i class="fas fa-lock"></i> Default Password
                </label>
                <input type="text" id="csv-password" class="form-control-github" placeholder="Default password for all users">
            </div>
        </div>
        
        <div style="display: flex; gap: 12px; margin-bottom: 20px;">
            <button onclick="generateUserCSV()" class="btn-github btn-github-primary">
                <i class="fas fa-download"></i> Generate CSV File
            </button>
            <button onclick="previewCSV()" class="btn-github">
                <i class="fas fa-eye"></i> Preview CSV
            </button>
        </div>
        
        <div id="csv-download-area" class="data-display"></div>
        
        <div id="csv-preview-area" class="csv-preview"></div>
    </div>
</div>
</div>

<script>
